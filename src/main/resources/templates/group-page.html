<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Home page di Cascina Marcella, su questa pagina inizierai a scoprire la storia, i prodotti e i nostri valori.">
    <meta name="keywords" content="Agricoltura, prodotti bio, verdura, frutta, uova, consegne a domicilio">
    <meta name="author" content="Edoardo Orta">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-3.6.0.js"        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="js/nav.js"></script>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="/img/logo.png">
    <title>Feed</title>
</head>
<body>
    <header id="navbarContainer"></header>
    <main class="container-fluid">
        
        <div class="container">
            <div class="row">
                <div class="col-4">
                    <h1>[[${group.name}]]</h1>
                    <p><small> <strong>Id:</strong> <span id="groupId">[[${group.id}]]</span></small></p>
                    <p><strong>Budget:</strong> [[${group.budget}]] â‚¬</p>
                    <p><strong>Email:</strong> <a th:href="@{'mailto:'+${group.groupEmail}}">[[${group.groupEmail}]]</a></p>
                </div>
                <div class="col-4">
                    <!-- TODO inser statistics or something so -->
                </div>
                <div class="col-4">
                    <h2>Membri:</h2>
                    <ul>
                        <li th:each=" member : ${members}">
                            <a th:href="@{'/member?id='+${member.id}}">[[${member.name}]]</a>
                        </li>
                    </ul>
                </div>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col">
                            <h3>Regali:</h3>
                            <div class="container">
                                <div class="row">
                                    <div class="col-md-3" th:each="regalo : ${gifts}">
                                        <div class="card" >
                                            <div class="card-body" >
                                                <a th:href="@{'/gift?id='+${regalo.id}}">
                                                    <h5 class="card-title">
                                                        [[${regalo.name}]]
                                                    </h5>
                                                </a>
                                                    </div>
                                                    <hr>
                                                    <div class="card-body">
                                                        <p class="card-text"><strong>Review:</strong> [[${regalo.review}]] <i class="fas fa-star"></i></p>
                                                        <p class="card-text">
                                                            <strong>Babbo:</strong>
                                                            <span th:each="membro : ${members}" >
                                                                <a th:href="@{'/member?id='+${babboId}}">
                                                                    <span th:if="${regalo.babboId==membro.id}"> [[${membro.name}]]</span>
                                                                </a>
                                                            </span>
                                                        </p>
                                                        <p class="card-text">
                                                            <strong>Basium:</strong>
                                                            <span th:each="membro : ${members}" >
                                                                <a th:href="@{'/member?id='+${basiumId}}"><span th:if="${regalo.basiumId==membro.id}"> [[${membro.name}]]</span></a>
                                                            </span>
                                                            </p>
                                                        <p class="card-text"><strong>Data:</strong> [[${regalo.date}]]</p>
                                                    </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container" id="settingsContainer">
                    <div class="row">
                        <div class="col">
                            <h2>
                                Impostazioni
                            </h2>
                            <!-- TODO group update page -->
                            <div class="alert alert-primary row"><div class="col-md-8">Aggiorna le informazioni di questo gruppo:</div> <div class="col"></div><a class="btn btn-primary col-md-2" id="updateGroup" th:href="@{'/group-update?id='+${group.id}}">Modifica</a></div>
                            <div class="alert alert-danger row"><div class="col-md-8">Elimina questo gruppo e tutti i suoi regali:</div> <div class="col"></div><button class="btn btn-danger col-md-2" id="deleteGroup" >Elimina</button></div>
                            
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>
    <footer id="footerContainer"></footer>
</body>
<script>
    $('#deleteGroup').click(function(){
        let result= prompt('Inserisci la password per eliminare il gruppo:','');
            
                $.ajax({
                    url: '/group',
                    type: 'DELETE',
                    data: {
                        id: $('#groupId').text(),
                        password: result
                        },
                    success: function(data){
                        if(data.status=='ok'){
                            window.location.href = '/';
                        }
                        else{
                            alert('Password errata');
                        }
                        
                    }
                });
            
        });
</script>
